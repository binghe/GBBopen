<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- XML file produced from file: tutorial.tex
     using Hyperlatex v 2.9-in-waiting-rk (c) Otfried Cheong -->
<head>
<title>GBBopen 1.1 Tutorial -- Enhancing Your Development Environment</title>
</p>
<link rel="SHORTCUT ICON" href="favicon.ico"><link rel=stylesheet
        href="gbbopen.css" type="text/css" />
</head>
<body>
<table width="100%" cellpadding="0" cellspacing="2"><tr>
<td bgcolor="#99ccff"><a href="tutorial-deleting-instances.html"><img border="0" alt="Deleting Instances" src="previous.png"/></a></td><td bgcolor="#99ccff"><a href="tutorial_0.html"><img border="0" alt="Top" src="up.png"/></a></td><td bgcolor="#99ccff"><a href="tutorial-working-within-a-file.html"><img border="0" alt="Working Within a File" src="next.png"/></a></td><td align="center" bgcolor="#99ccff" width="100%"><b>Enhancing Your Development Environment</b></td><td bgcolor="#99ccff"><a target="_top" href="tutorial.html"><img border="0" alt="GoTo Top" src="top.png"/></a></td></tr></table>
<h1>Enhancing Your Development Environment</h1>
<p>Now that you are experienced creating and deleting unit and space instances in
GBBopen, we will take a short break before working further on our random-walk
application.  In the exercises thus far, we have been working directly in
Common Lisp's REPL.  As our application develops, we want to save our code in
files. In this exercise, we will provide recommendations for making your
GBBopen and Common Lisp environment more productive.  Even if you have already
customized your Common Lisp setup, I recommend surveying this exercise for
useful GBBopen tips.
</p>
<p><hr color="99CCCC">
This exercise shows you how to:
</p>
<p><ul class="tight"><li>Add GBBopen keyword commands to your Common Lisp implementation
<li>Customize your Common Lisp initialization file
<li>Set up GBBopen HyperDoc and Common Lisp HyperSpec access
</ul>
</p>
<hr color="99CCCC">
<h2><a name="id1">Step 1: Autoloading GBBopen</a></h2><p>
Thus far, we have entered the forms:
<pre class="pretop">
<font color="#667f66">  cl-user&gt; <font color="#000000">(load "<var>&lt;install-dir&gt;</var>/startup.lisp")</font>
     ...
  cl-user&gt; <font color="#000000">(mini-module:compile-module :gbbopen-user :propagate :create-dirs)</font>
     ...
  cl-user&gt; <font color="#000000">(in-package :gbbopen-user)</font>
  #&lt;package GBBOPEN-USER&gt;
  gbbopen-user&gt;</font>
</pre>
to compile and load needed GBBopen components and to set the current package
to <code>:gbbopen-user</code>.  We can set up our Common Lisp environment so that we
can do this (and eventually compile and load our random-walk application) by
issuing only a single command.
</p>
<p>The file <code><var>&lt;install-dir&gt;</var>/initiate.lisp</code> is an
alternative for <code><var>&lt;install-dir&gt;</var>/startup.lisp</code> that adds
handy GBBopen keyword commands to the top-level REPL listener for
<a target="_top" href="http://www.franz.com">Allegro CL</a>,
<a target="_top" href="http://clisp.cons.org/">CLISP</a>,
<a target="_top" href="http://clozure.com/clozurecl.html">Clozure CL</a>,
<a target="_top" href="http://www.cons.org/cmucl/">CMUCL</a>,
<a target="_top" href="http://common-lisp.net/project/ecl/">ECL</a>,
<a target="_top" href="http://www.lispworks.com">LispWorks</a>,
<a target="_top" href="http://sbcl.sourceforge.net">SBCL</a> and
<a target="_top" href="http://www.scieneer.com/scl/">Scieneer CL</a>
users.  GBBopen keyword commands
are also supported in
<a target="_top" href="http://common-lisp.net/project/slime/">SLIME</a>'s Emacs-based REPL.
Other interaction interfaces that use their own REPL, rather than the one
provided by Common Lisp, may not support keyword REPL command processing
(see below).
</p>
<p>To make these GBBopen keyword commands available, simply load the file
<code><var>&lt;install-dir&gt;</var>/initiate.lisp</code> rather than
<code><var>&lt;install-dir&gt;</var>/startup.lisp</code>.  Let's try it.  Start up a fresh
Common Lisp session and enter the following form in the REPL:
<pre class="pretop">
<font color="#667f66">  cl-user&gt; <font color="#000000">(load "<var>&lt;install-dir&gt;</var>/initiate.lisp")</font>
  ;; Loading <var>&lt;install-dir&gt;</var>/initiate.lisp
  ;;  Loading <var>&lt;install-dir&gt;</var>/extended-repl.lisp
  ;;  Loading <var>&lt;install-dir&gt;</var>/commands.lisp
  t
  cl-user&gt;</font>
</pre>
</p>
<p><a name="id2">Note</a> that the Mini Module system and GBBopen
module definitions have not been loaded.  Now enter the REPL
command, <b>:gbbopen-user</b>:
<pre class="pretop">
<font color="#667f66">  cl-user&gt; <font color="#000000">:gbbopen-user</font>
  ;; Loading <var>&lt;install-dir&gt;</var>/startup.lisp
     ...
  ;; Loading <var>&lt;install-dir&gt;</var>/<var>&lt;platform-dir&gt;</var>/gbbopen/gbbopen-user.fasl
  gbbopen-user&gt;</font>
</pre>
The <code>:gbbopen-user</code> module (and supporting modules) are loaded, and the
current package is set to <code>:gbbopen-user</code>:
<pre>
<font color="#667f66">  gbbopen-user&gt; <font color="#000000">*package*</font>
  #&lt;package GBBOPEN-USER&gt;
  gbbopen-user&gt;</font>
</pre>
</p>
<p>Module-compilation REPL commands, such as <code>:gbbopen-user</code>,
always include the <code>:propagate</code> option when they call the Mini Module
<b>compile-module</b> function.  We don't need to specify it as a command
option.
</p>
</p>
<h3><a name="id3">If it didn't work<i>...</i></a></h3><p>
If you are running GBBopen in a Common Lisp environment that doesn't support
REPL commands and the <b>:gbbopen-user</b> REPL command didn't
work, all is not lost.  Loading <code><var>&lt;install-dir&gt;</var>/initiate.lisp</code>
also defines functions in the <code>:common-lisp-user</code> package with the same
name as the REPL command:
<pre class="pretop">
<font color="#667f66">  cl-user&gt; <font color="#000000">(gbbopen-user)</font>
  ;; Loading <var>&lt;install-dir&gt;</var>/startup.lisp
     ...
  ;; Loading <var>&lt;install-dir&gt;</var>/<var>&lt;platform-dir&gt;</var>/gbbopen/gbbopen-user.fasl
  gbbopen-user&gt;</font>
</pre>
</p>
<h3><a name="sec:REPL-command-syntax">REPL command syntax</a></h3>
<p>GBBopen's REPL commands are defined to mimic the syntax of existing REPL
commands in your Common Lisp environment.  On many Common Lisp
implementations, or if you are using the
<a target="_top" href="http://common-lisp.net/project/slime/">SLIME</a> interface, REPL
commands with arguments can be specified in either list or &#8220;spread&#8221;
notation.  For example:
<pre class="pretop">
<font color="#667f66">  cl-user&gt; <font color="#000000">(:gbbopen-user :create-dirs)</font>
  ;; Loading <var>&lt;install-dir&gt;</var>/startup.lisp
     ...
  ;; Loading <var>&lt;install-dir&gt;</var>/<var>&lt;platform-dir&gt;</var>/gbbopen/gbbopen-user.fasl
  gbbopen-user&gt;</font>
</pre>
or
<pre>
<font color="#667f66">  cl-user&gt; <font color="#000000">:gbbopen-user :create-dirs</font>
  ;; Loading <var>&lt;install-dir&gt;</var>/startup.lisp
     ...
  ;; Loading <var>&lt;install-dir&gt;</var>/<var>&lt;platform-dir&gt;</var>/gbbopen/gbbopen-user.fasl
  gbbopen-user&gt;</font>
</pre>
</p>
<p>However, <a target="_top" href="http://www.franz.com">Allegro CL</a>,
<a target="_top" href="http://clisp.cons.org/">CLISP</a>, and
<a target="_top" href="http://www.lispworks.com">LispWorks</a> do not support the list
notation.  CLISP versions prior to 2.45 and
<a target="_top" href="http://common-lisp.net/project/ecl/">ECL</a> only support the spread
notation&mdash;but without arguments.  So, a user running on these Common
Lisp implementations must use the <code>:common-lisp-user</code> functions rather
than a REPL command when the command requires arguments:
<pre class="pretop">
<font color="#667f66">  cl-user&gt; <font color="#000000">(cl-user:gbbopen-user :create-dirs)</font>
  ;; Loading <var>&lt;install-dir&gt;</var>/startup.lisp
     ...
  ;; Loading <var>&lt;install-dir&gt;</var>/<var>&lt;platform-dir&gt;</var>/gbbopen/gbbopen-user.fasl
  gbbopen-user&gt;</font>
</pre>
or use the <a target="_top" href="http://common-lisp.net/project/slime/">SLIME</a> REPL
interface.
</p>
<p>We will show the <a href="#sec:REPL-command-syntax">spread command syntax</a>
throughout the rest of the Tutorial.  If you are running a
<a target="_top" href="http://clisp.cons.org/">CLISP</a> version prior to 2.45, remember to
use the <code>:common-lisp-user</code> function rather than the REPL command when
the command requires arguments.  (Equivalent functions in the
<code>:common-lisp-user</code> package are always defined for each REPL
keyword command, and these functions can be used when REPL keyword
processing is not fully supported.)
</p>
<h2><a name="id5">Step 2: Customizing your Common Lisp initialization file</a></h2><p>
I'm lazy and would rather not have to explicitly load the
<code><var>&lt;install-dir&gt;</var>/initiate.lisp</code> file each time I start a new
Common Lisp session.  So, I have my Common Lisp's initialization file load it
for me.  To make it easy to similarly customize different Common Lisp
implementations, I use the following strategy:
</p>
<ol>
<li>I create a file, <code>shared-init.lisp</code>, in my home directory,
containing the following:
<pre>
  (in-package :common-lisp-user)

  ;; My personal preferences.  Note: Allegro CL requires 
  ;; tpl:setq-default during initialization to retain changes
  ;; to these global variables (done in .clinit.cl):
  (setf *print-case* ':downcase)
  (setf *compile-verbose* 't)
  (setf *load-verbose* 't)

  (let ((defaults *load-truename*))
    (load (make-pathname 
            ;; where GBBopen is installed:
            :directory '(:absolute <font color="#ff0000">"usr" "local" "gbbopen"</font>)
            :name "initiate"
            :type "lisp"
            :defaults defaults)))
</pre>
<p>The <code>:directory</code> argument to <code>make-pathname</code> is a Common Lisp
<i>absolute pathname</i> that is portable across all operating systems.  I
installed my GBBopen in <code>/usr/local/gbbopen/</code>, and I specified this with
the <code>"usr"</code>, <code>"local"</code>, and <code>"gbbopen"</code> elements in the
<code>:directory</code> argument.  Change these elements as appropriate for the
location of your GBBopen installation.
</p>
</li><li>For each Common Lisp implementation that I use, I create a personal
initialization file that performs any implementation-specific
initializations and then loads <code>shared-init.lisp</code>.  For example, here
is the <code>.clisprc</code> initialization file that I use for
<a target="_top" href="http://clisp.cons.org/">CLISP</a>:
<pre>
  (in-package :common-lisp-user)

  ;; enable maximum ANSI compliance:
  (setf custom:*ansi* 't)

  (let ((defaults *load-truename*))
    (load (make-pathname 
            :name "shared-init"
            :type "lisp"
            :defaults defaults)))
</pre>
<p><a target="_top" href="http://sbcl.sourceforge.net">SBCL</a> has a very strict interpretation
of <code>*load-truename*</code> semantics, so my <code>.sbclrc</code> initialization file
is:
<pre class="pretop">
  (in-package :common-lisp-user)

  ;; *load-truename* returns nil when used in SBCL's .sbclrc 
  ;; initialization file, so use (user-homedir-pathname):
  (let ((defaults (user-homedir-pathname)))
    (load (make-pathname 
            :name "shared-init"
            :type "lisp"
            :defaults defaults)))
</pre>
</p>
<p>Here is my <code>.clinit.cl</code> initialization file for
<a target="_top" href="http://www.franz.com">Allegro CL</a>:
<pre class="pretop">
  (in-package :common-lisp-user)

  ;; Allegro CL requires tpl:setq-default during initialization
  ;; to retain changes to these global variables:
  (tpl:setq-default *print-case* ':downcase)
  (tpl:setq-default *compile-verbose* 't)
  (tpl:setq-default *load-verbose* 't)

  (let ((defaults *load-truename*))
    (load (make-pathname 
            :name "shared-init"
            :type "lisp"
            :defaults defaults)))
</pre>
</p>
<p>The initialization file names for supported GBBopen ports are:
</p>
<table class="tight"><tbody><tr>
<td valign="baseline" colspan="1" align="left">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td><td valign="baseline" colspan="1" align="left"> <a target="_top" href="http://www.franz.com">Allegro CL</a> </td><td valign="baseline" colspan="1" align="left">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td><td valign="baseline" colspan="1" align="left"> <code>.clinit.cl</code> </td></tr>
<tr>
<td valign="baseline" colspan="1" align="left"></td><td valign="baseline" colspan="1" align="left"> <a target="_top" href="http://clisp.cons.org/">CLISP</a> </td><td valign="baseline" colspan="1" align="left">
</td><td valign="baseline" colspan="1" align="left"> <code>.clisprc</code> </td></tr>
<tr>
<td valign="baseline" colspan="1" align="left"></td><td valign="baseline" colspan="1" align="left"> <a target="_top" href="http://clozure.com/clozurecl.html">Clozure CL</a> </td><td valign="baseline" colspan="1" align="left">
</td><td valign="baseline" colspan="1" align="left"> <code>ccl-init.lisp</code> </td></tr>
<tr>
<td valign="baseline" colspan="1" align="left"></td><td valign="baseline" colspan="1" align="left"> <a target="_top" href="http://www.cons.org/cmucl/">CMUCL</a> </td><td valign="baseline" colspan="1" align="left">
</td><td valign="baseline" colspan="1" align="left"> <code>init.lisp</code> </td></tr>
<tr>
<td valign="baseline" colspan="1" align="left"></td><td valign="baseline" colspan="1" align="left"> <a target="_top" href="http://www.digitool.com">Digitool MCL</a> </td><td valign="baseline" colspan="1" align="left">
</td><td valign="baseline" colspan="1" align="left"> (see below) </td></tr>
<tr>
<td valign="baseline" colspan="1" align="left"></td><td valign="baseline" colspan="1" align="left"> <a target="_top" href="http://common-lisp.net/project/ecl/">ECL</a> </td><td valign="baseline" colspan="1" align="left">
</td><td valign="baseline" colspan="1" align="left"> <code>.eclrc</code> </td></tr>
<tr>
<td valign="baseline" colspan="1" align="left"></td><td valign="baseline" colspan="1" align="left"> <a target="_top" href="http://www.lispworks.com">LispWorks</a> </td><td valign="baseline" colspan="1" align="left">
</td><td valign="baseline" colspan="1" align="left"> <code>.lispworks</code> </td></tr>
<tr>
<td valign="baseline" colspan="1" align="left"></td><td valign="baseline" colspan="1" align="left"> <a target="_top" href="http://sbcl.sourceforge.net">SBCL</a> </td><td valign="baseline" colspan="1" align="left"> 
</td><td valign="baseline" colspan="1" align="left"> <code>.sbclrc</code> </td></tr>
<tr>
<td valign="baseline" colspan="1" align="left"></td><td valign="baseline" colspan="1" align="left"> <a target="_top" href="http://www.scieneer.com/scl/">Scieneer CL</a> </td><td valign="baseline" colspan="1" align="left">
</td><td valign="baseline" colspan="1" align="left"> <code>init.lisp</code> </td></tr>
<tr>
<td valign="baseline" colspan="1" align="left"></td></tr></tbody></table>
<p><a target="_top" href="http://www.digitool.com">Digitool MCL</a> does not look for an
initialization file in the user's home directory.  Instead it loads the file
<code>init.lisp</code> in it's installation directory.  One approach is to have that
file load a personal initialization file, say <code>mcl-init.lisp</code>, from the
user's home directory, if a <code>mcl-init.lisp</code> file is present.
</p>
<p>The Personal Edition of <a target="_top" href="http://www.lispworks.com">LispWorks</a> does
not load initialization files, requiring you to manually load your
<code>.lispworks</code> file each time you start up
<a target="_top" href="http://www.lispworks.com">LispWorks</a>.
</p>
<p>The interpretation of where a user's &#8220;home&#8221; directory is located is
inconsistent on Windows.  Ideally, the &#8220;home directory&#8221; location
used for the Common Lisp implementation's initialization file and the
result of the Common Lisp function <code>user-homedir-pathname</code> should
be consistent.  Then, by using the <code>shared-init.lisp</code> scheme, you
only need to determine where the initialization file should be for
each Common Lisp implementation that you use, and then you can have
those implementation-specific initialization files load your
<code>shared-init.lisp</code> file from whichever directory <u>you</u>
deem as your &#8220;home&#8221; directory.
</p>
<p><a name="ref:your-homedir">Here</a> is a quick way to have Common Lisp tell you where it thinks your &#8220;home&#8221;
directory is located:
<pre class="pretop">
<font color="#667f66">  cl-user&gt; <font color="#000000">(truename (user-homedir-pathname))</font>
  "C:\\Documents and Settings\\corkill\\"
  cl-user&gt;</font>
</pre>
We will refer to this directory from now on as your &#8220;homedir&#8221; directory.
</p>
<br />&nbsp;<br /></li><li>With this setup in place, all that is needed to use GBBopen is
to start up a Common Lisp and type a GBBopen command, such as
<code>:gbbopen-user</code>.  My fingers thank me!
</li></ol>
<h2><a name="id7">Step 3: Set up  HyperDoc and HyperSpec access</a></h2><p>
If you are using
<a target="_top" href="http://www.gnu.org/software/emacs/emacs.html">Emacs</a> in your Common
Lisp development environment, you can make it easy to bring up appropriate
Common Lisp and GBBopen documentation in your browser.  The file
<code><var>&lt;install-dir&gt;</var>/browse-hyperdoc.el</code> defines an interactive Emacs
command named <code>browse-hyperdoc</code> and binds it to <code>META-?</code> (on most
keyboards, <code>META-?</code> means pressing both <code>Alt</code> and <code>?</code> keys at
the same time) .  To enable this Emacs command, add a command to load
<code><var>&lt;install-dir&gt;</var>/browse-hyperdoc.el</code> in your <code>.emacs</code>
initialization file:
<pre class="pretop">
  ;; GBBopen hyperdoc (where GBBopen was installed):
  (load "<var>&lt;install-dir&gt;</var>/browse-hyperdoc")
</pre>
</p>
<p>If there is no <code>.emacs</code> file present in your home directory, simply
create one containing the above command. Once again, Windows users need to
worry about where Emacs looks for their &#8220;home&#8221; directory.
</p>
<p>While you are editing your <code>.emacs</code> file, you might also want to add a
command to load GBBopen's Emacs indentation customizations:
<pre class="pretop">
  ;; GBBopen indentations (where GBBopen was installed):
  (load "<var>&lt;install-dir&gt;</var>/gbbopen-indent")
</pre>
</p>
<p>If you are using
<a target="_top" href="http://www.gigamonkeys.com/book/lispbox/"><i>Lispbox</i></a>, you
will have to enable loading of the <code>.emacs</code> initialization file, as it is
disabled in the Lispbox startup file.  Edit the Lispbox startup file
(<code>lispbox.bat</code> on Windows, <code>lispbox.sh</code> on Unix, and
<code>/Applications/Lispbox/Emacs.app/Contents/MacOS/lispbox.sh</code> on Mac OS)
and remove the <code>--no-init-file</code> option from the Emacs invocation line.
</p>
<h3><a name="id8">Adding the Common Lisp HyperSpec</a></h3><p>
The <a target="_top" href="http://GBBopen.org/downloads/hyperspec.el">hyperspec.el</a>
utility is included in the
<a target="_top" href="http://common-lisp.net/project/slime/">SLIME</a> and
<a target="_top" href="http://sourceforge.net/projects/ilisp/">ILISP</a> distributions.
However, if <code>hyperspec.el</code> is not already part of your Emacs, you can
download it and explicitly load it from your <code>.emacs</code> initialization
file.  Once <code>hyperspec.el</code> is present, GBBopen's <code>browse-hyperdoc</code>
Emacs command will automatically defer to the <a target="_top" href="http://www.lispworks.com/documentation/HyperSpec/">Common Lisp
HyperSpec</a> when given a
non-GBBopen entity.
</p>
<p>I prefer to download a local copy of the Common Lisp HyperSpec using the
<a target="_top" href="ftp://ftp.lispworks.com/pub/software_tools/reference/HyperSpec-7-0.tar.gz">down-loadable
archive</a>
provided by <a target="_top" href="http://www.lispworks.com">LispWorks</a>, LTD.  This allows
me to quickly reference the HyperSpec without a network connection.  I set the
value of <code>common-lisp-hyperspec-root</code> in my <code>.emacs</code> initialization
file to a URL that points to my local copy of the HyperSpec:
<pre class="pretop">
  (setf common-lisp-hyperspec-root "file:/usr/local/CLHS/")
</pre>
</p>
<h3><a name="id9">Non-Emacs access</a></h3><p>
If you are not using an Emacs-based environment, GBBopen provides a Common
Lisp function, <b>browse-hyperdoc</b>, that can be used to access GBBopen
HyperDoc pages from Common Lisp.  GBBopen's <code>:os-interface</code> module must
be loaded to make <b>browse-hyperdoc</b> available.  For example:
<pre class="pretop">
<font color="#667f66">  cl-user&gt; <font color="#000000">:os-interface</font>
  ;; Loading <var>&lt;install-dir&gt;</var>/startup.lisp
     ...
  ;; Loading <var>&lt;install-dir&gt;</var>/<var>&lt;platform-dir&gt;</var>/tools/os-interface.fasl
  gbbopen-tools&gt; <font color="#000000">(browse-hyperdoc 'define-unit-class)</font>
  t
  gbbopen-tools&gt;</font>
</pre>
will display the GBBopen HyperDoc page for <b>define-unit-class</b> in your
browser.  Note that the <code>:gbbopen-user</code> module requires (and therefore
loads) the <code>:os-interface</code> module, so if you have loaded
<code>:gbbopen-user</code>, you do not need to do anything further in order to call
<b>browse-hyperdoc</b>.
</p>
<hr /><address><a target="_top" class="address"
    href="http://GBBopen.org/"><p>The GBBopen Project</a></address><br />
<table width="100%" cellpadding="0" cellspacing="2"><tr>
<td bgcolor="#99ccff"><a href="tutorial-deleting-instances.html"><img border="0" alt="Deleting Instances" src="previous.png"/></a></td><td bgcolor="#99ccff"><a href="tutorial_0.html"><img border="0" alt="Top" src="up.png"/></a></td><td bgcolor="#99ccff"><a href="tutorial-working-within-a-file.html"><img border="0" alt="Working Within a File" src="next.png"/></a></td><td align="center" bgcolor="#99ccff" width="100%"><b>Enhancing Your Development Environment</b></td><td bgcolor="#99ccff"><a target="_top" href="tutorial.html"><img border="0" alt="GoTo Top" src="top.png"/></a></td></tr></table></body></html>
