<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- XML file produced from file: tutorial.tex
     using Hyperlatex v 2.9-in-waiting-rk (c) Otfried Cheong -->
<head>
<title>GBBopen 0.9.8 Tutorial -- Adding Dimensions</title>
</p>
<link rel="SHORTCUT ICON" href="favicon.ico"><link rel=stylesheet
        href="gbbopen.css" type="text/css" />
</head>
<body>
<table width="100%" cellpadding="0" cellspacing="2"><tr>
<td bgcolor="#99ccff"><a href="tutorial-working-within-a-file.html"><img border="0" alt="Working Within a File" src="previous.png"/></a></td><td bgcolor="#99ccff"><a href="tutorial_0.html"><img border="0" alt="Top" src="up.png"/></a></td><td bgcolor="#99ccff"><a href="tutorial-control-shell.html"><img border="0" alt="Using a Control Shell" src="next.png"/></a></td><td align="center" bgcolor="#99ccff" width="100%"><b>Adding Dimensions</b></td><td bgcolor="#99ccff"><a target="_top" href="tutorial.html"><img border="0" alt="GoTo Top" src="top.png"/></a></td></tr></table>
<h1>Adding Dimensions</h1>
<p>A central concept in GBBopen is <i>dimensionality</i>.  Dimensional
abstraction of space instances, unit instances, and proximity-based
retrieval patterns is used to provide a semantically meaningful
separation of blackboard-repository storage mechanisms from system and
application code.  This separation provides flexibility in developing
and evolving complex blackboard applications and allows GBBopen to
change storage and search strategies and optimizations dynamically.
</p>
<p>Each space instance can be created as a conceptual hyper-dimensional
volume.  Unit instances occupy multidimensional extent based on their
attributes.  The location of a unit instance within the space instance
is determined by the intersection of the space instance's
dimensionality and the unit instance's dimension values.
</p>
<p>GBBopen supports three types of dimensions:
</p>
<p><ul class="tight"><li><i>ordered</i>: a real-number line
<li><i>boolean</i>: true and false values
<li><i>enumerated</i>: a set of named elements (the set can be
either closed or infinite)
</ul>
Determining the dimensionality of space and unit instances is an
important part of designing a blackboard application.
</p>
<p>In this exercise, we will redefine the <code>location</code> unit class to
have two ordered dimensions, <code>x</code> and <code>y</code>, that represent
Euclidean positions on a two-dimensional plane.  Then we will create a
two-dimensional <code>known-world</code> space instance, create some
<code>location</code> unit instances on the <code>known-world</code>, and retrieve
the instances based on their two-dimensional positions.
</p>
<p><hr color="99CCCC">
This exercise shows you how to:
</p>
<p><ul class="tight"><li>Add dimensional values to a unit-class definition
<li>Create a multidimensional space instance
<li>Retrieve unit instances from a space instance based on their
dimensional values
<li>Compile and load individual forms directly from an Emacs file
buffer using the SLIME or ELI environments
</ul>
</p>
<hr color="99CCCC">
<h2><a name="id1">Prerequisites</a></h2>
<p><ul class="tight"><li>The <code>tutorial-example.lisp</code> file created in the last exercise, containing:
</p>
<pre><font color="#8c8c8c">(in-package :gbbopen-user)

(define-unit-class location ()
  (x y))
</pre></font>
<br /><li><p>The <code>:gbbopen-user</code> module is loaded
</ul>
</p>
<h2><a name="id2">Step 1: Add dimensions to the <code>location</code> unit class</a></h2><p>
Edit your <code>tutorial-example.lisp</code> file, and change the
<code>location</code> unit-class definition as follows:
</p>
<pre><font color="#8c8c8c">  (define-unit-class location ()
    (x y)
    <font color="#000000">(:dimensional-values
      (x :point x)
      (y :point y))</font>)
</pre></font>
<p>In this tutorial, we will highlight code additions and changes using a
black font.
</p>
<p>The <code>:dimensional-values</code> unit-class option specifies that
<code>location</code> unit instances have two ordered dimensions, <code>x</code>
and <code>y</code>, and that the value of each dimension will be a single
numeric value obtained from the slots <code>x</code> and <code>y</code>,
respectively.
</p>
<p>Because we chose to use the same name for each dimension and its
associated slot value, our <code>:dimensional-values</code> option might
appear to be double-talk.  We could have defined our class as:
</p>
<pre><font color="#8c8c8c">  (define-unit-class location ()
    (x-slot y-slot)
    (:dimensional-values
      (x :point x-slot)
      (y :point y-slot)))
</pre></font>
<p>which clarifies the semantics of the <code>:dimensional-values</code>
option.  Often, however, it is most convenient to use the same name
for a slot and the dimension associated with the slot's value, so we
will stick with our original definition.
</p>
<h2><a name="id3">Step 2: Compile and load the new definition</a></h2><p>
We could compile and load the entire <code>tutorial-example.lisp</code> file
just as we did in the last exercise.  However, as we develop our
application it can be convenient to compile and load (and debug) each
form as we write it.  Your Common Lisp development environment should
provide this capability.  In SLIME, the command to compile the current
top-level form is <code>C-c C-c</code>.  In Allegro's ELI, the command is
<code>C-c C-x</code>.  Try compiling and loading just the new
<code>location</code> unit-class definition.
</p>
<h2><a name="id4">Step 3: Make  a <code>location</code> unit instance</a></h2><p>
Let's test our new <code>location</code> unit class definition by making an
instance.  Enter the following form in the REPL:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(defparameter ui (make-instance 'location :x 40 :y 60))</font>
  ui
  &gt;
</pre></font>
<p><a name="id5">and</a> display its description:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(describe-instance ui)</font>
  Location #&lt;location 1&gt;
    Instance name: 1
    Space instances: None
    Dimensional values:
      x:  40
      y:  60
    Non-link slots:
      x:  40
      y:  60
    Link slots: None
  &gt;
</pre></font>
<p>Note the dimensional values for the <code>x</code> and <code>y</code> dimensions.
</p>
<h2><a name="id6">Step 4: Make  the <code>known-world</code> space instance</a></h2><p>
Create the <code>known-world</code> space instance by evaluating:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(defparameter si (make-space-instance '(known-world)))</font>
  si
  &gt;
</pre></font>
<h2><a name="id7">Step 5: Add the unit instance to the space instance</a></h2><p>
Now, add the <code>location</code> unit instance to the space instance:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(add-instance-to-space-instance ui si)</font>
  Warning: In add-instance-to-space-instance: #&lt;location 1&gt;
           does not share any dimensions with space instance 
           #&lt;standard-space-instance (known-world)&gt;.
  #&lt;location 1&gt;
  &gt;
</pre></font>
<p><a name="id8">GBBopen</a> has warned us that our <code>location</code> unit instance does not
have any dimensions in common with the <code>known-world</code> space
instance (because we didn't specify any dimensions for the
<code>known-world</code>).  GBBopen dutifully added the unit instance, as
shown by <b>describe-blackboard-repository</b>:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(describe-blackboard-repository)</font>
  
  Space Instance                Contents
  --------------                --------
  known-world                   1 instance (1 location)

  Unit Class                    Instances
  ----------                    ---------
  location                              1
  standard-space-instance               1
                                ---------
                                        2 instances
  &gt;
</pre></font>
<p>but we cannot perform dimension-based retrieval of our <code>location</code>
unit instance on the <code>known-world</code>.
</p>
<h2><a name="id9">Step 6: Create a dimensioned <code>known-world</code></a></h2><p>
Let's delete the <code>known-world</code> and create another one&mdash;this time
with <code>x</code> and <code>y</code> dimensions:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(delete-space-instance si)</font>
  #&lt;standard-space-instance (known-world) [Deleted]&gt;
  &gt; <font color="#000000">(setf si (make-space-instance '(known-world)
              :dimensions '((x :ordered) (y :ordered))))</font>
  #&lt;standard-space-instance (known-world)&gt;
  &gt;
</pre></font>
<p>We have specified <code>x</code> and <code>y</code> as ordered dimensions, making the
<code>known-world</code> a two-dimensional Euclidean plane.  (Flatlanders would be
proud!)
</p>
<p><a name="id10">Verify</a> the dimensionality of the <code>known-world</code> space instance by evaluating:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(describe-space-instance si)</font>
  Standard-space-instance #&lt;standard-space-instance (known-world)&gt;
    Allowed unit classes: t
    Dimensions:
      (x :ordered)
      (y :ordered)
</pre></font>
<h2><a name="id11">Step 7: Add the <code>location</code> unit instance to the new
<code>known-world</code></a></h2><p>
Add the <code>location</code> unit instance to the new <code>known-world</code> space instance:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(add-instance-to-space-instance ui si)</font>
  #&lt;location 1&gt;
  &gt;
</pre></font>
<p>The dimension warning is gone.
</p>
<h2><a name="id12">Step 8: Adding every <code>location</code> to the <code>known-world</code>
automatically</a></h2><p>
Up to this point, we have used <b>add-instance-to-space-instance</b> to add
each <code>location</code> unit instance to the <code>known-world</code> space instance.
We can tell GBBopen to automatically add new unit instances to one or more
space instances by using the <code>:initial-space-instances</code> class option in
<b>define-unit-class</b>.
</p>
<p><a name="id13">Add</a> the following <code>:initial-space-instances</code> class option to the
<code>location</code> unit-class definition in your <code>tutorial-example.lisp</code>
file:
</p>
<pre><font color="#8c8c8c">  (define-unit-class location ()
    (x y)
    (:dimensional-values
      (x :point x)
      (y :point y))
    <font color="#000000">(:initial-space-instances (known-world))</font>)
</pre></font>
<p>Compile and load the new <code>location</code> unit-class definition.
</p>
<h2><a name="id14">Step 9: Create more <code>location</code> unit instances</a></h2><p>
Let's test our new <code>location</code> unit class definition by making another
instance.  Enter the following form in the REPL:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(make-instance 'location :x 70 :y 30)</font>
  #&lt;location 2&gt;
  &gt;
</pre></font>
<a name="id15"></a><p>and confirm that the new <code>location</code> is on the <code>known-world</code>:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">:dsbb</font>
  
  Space Instance                Contents
  --------------                --------
  known-world                   2 instances (2 location)

  Unit Class                    Instances
  ----------                    ---------
  location                              2
  standard-space-instance               1
                                ---------
                                        3 instances
  &gt;
</pre></font>
<p>Here we used GBBopen's <code>:dsbb</code> REPL command, which is equivalent to
evaluating <code>(describe-blackboard-repository)</code>.  Describing the repository
is a useful check that our unit instances and space instances are being
created and deleted as intended.
</p>
<p><a name="id16">Now,</a> let's populate the <code>known-world</code> with a few more <code>locations</code>s:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(make-instance 'location :x 20 :y 20)</font>
  #&lt;location 3&gt;
  &gt; <font color="#000000">(make-instance 'location :x 25 :y 25)</font>
  #&lt;location 4&gt;
  &gt; <font color="#000000">(make-instance 'location :x 20 :y 30)</font>
  #&lt;location 5&gt;
  &gt;
</pre></font>
<p>and verify that they are all on the <code>known-world</code>:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">:dsbb</font>
  
  Space Instance                Contents
  --------------                --------
  known-world                   5 instances (5 location)

  Unit Class                    Instances
  ----------                    ---------
  location                              5
  standard-space-instance               1
                                ---------
                                        6 instances
  &gt;
</pre></font>
<h2><a name="id17">Step 10: Dimensional retrieval</a></h2><p>
We have seen how we can use <b>find-instances</b> to retrieve all
<code>location</code> unit instances from the <code>known-world</code>:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(find-instances 'location '(known-world) :all)</font>
  (#&lt;location 5&gt; #&lt;location 4&gt; #&lt;location 3&gt; #&lt;location 2&gt; #&lt;location 1&gt;)
  &gt;
</pre></font>
<p><a name="id18">Now</a> that we have added <code>x</code> and <code>y</code> dimensions to <code>location</code>s
and the <code>known-world</code>, we can retrieve <code>location</code> unit instances
using dimensional patterns.  For example, let's retrieve the unit instance
positioned at (20,20):
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(find-instances 'location '(known-world)
      '(and (= x 20) (= y 20)))</font>
   (#&lt;location 3&gt;)
  &gt;
</pre></font>
<p><a name="id19">We</a> can use <b>describe-instance</b> to verify that we found the desired
<code>location</code> unit instance:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(find-instances 'location '(known-world)
      '(and (= x 20) (= y 20)))</font>
   (#&lt;location 3&gt;)
  &gt; <font color="#000000">(describe-instance (first *))</font>
  Location #&lt;location 3&gt;
    Instance name: 3
    Space instances: ((known-world))
    Dimensional values:
      x:  20
      y:  20
    Non-link slots:
      x:  20
      y:  20
    Link slots: None
  &gt;
</pre></font>
<p>Note that we used Common Lisp's REPL <code>*</code> variable that is always set to
the value returned by evaluating the last REPL expression (in this case, the
result of <b>find-instances</b>).
</p>
<h2><a name="id20">Step 11: Customize the display of <code>location</code> unit instances</a></h2><p>
It would be convenient if we could easily see the coordinates of
<code>location</code> unit instances without having to describe them.  Fortunately,
GBBopen makes this is easy to do by providing the
<b>print-instance-slots</b> generic function that allows us to extend how
Common Lisp's <code>print-object</code> displays <code>location</code> unit instances.
</p>
<p><a name="id21">Add</a> the following <b>print-instance-slots</b> method <u>after</u> the
<code>location</code> unit-class definition in your <code>tutorial-example.lisp</code>
file:
</p>
<pre><font color="#8c8c8c">  (define-unit-class location ()
    (x y)
    (:dimensional-values
      (x :point x)
      (y :point y))
    (:initial-space-instances (known-world)))

  <font color="#000000">(defmethod print-instance-slots ((location location) stream)
    (call-next-method)
    (when (and (slot-boundp location 'x)
               (slot-boundp location 'y))
      (format stream " (~s ~s)"
              (x-of location)
              (y-of location))))</font>
</pre></font>
<p>The method first performs a <code>(call-next-method)</code> to produce the initial
printed representation of the <code>location</code> unit instance.  It then checks
that both <code>x</code> and <code>y</code> slots are bound and, if so, writes the
<code>location</code>'s coordinates to the output stream.  Checking that the slots
are bound is necessary to avoid generating an error in the
<b>print-instance-slots</b> if the slots have not been given a value.  You
should always perform this safety check in any <b>print-instance-slots</b>
methods.
</p>
<p><a name="id22">Now,</a> compile and load the <b>print-instance-slots</b> method and try it
out:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(find-instances 'location '(known-world)
      '(= (x y) (20 20)))</font>
   (#&lt;location 3 (20 20)&gt;)
  &gt;
</pre></font>
<p>Note that this time we used a two-dimensional (<code>x</code>,<code>y</code>) retrieval
pattern rather than the conjunction of two one-dimensional patterns that we
used previously.  The two patterns are equivalent, but often a
higher-dimensional pattern may be more convenient than a conjunction.  Also
note that we can see immediately that we retrieved the desired
<code>location</code>.
</p>
<h2><a name="id23">Step 12: More dimensional retrievals</a></h2><p>
Let's try some additional dimensional retrievals.
</p>
<p>Find all <code>location</code>s with an <code>x</code> position of 20:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(find-instances 'location '(known-world)
      '(= x 20))</font>
   (#&lt;location 5 (20 30)&gt; #&lt;location 3 (20 20)&gt;)
  &gt;
</pre></font>
<p>Find all <code>location</code>s with whose <code>x</code> and <code>y</code> coordinates
are less than or equal to 25:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(find-instances 'location '(known-world)
      '(&lt;= (x y) (25 25)))</font>
  (#&lt;location 4 (25 25)&gt; #&lt;location 3 (20 20)&gt;)
  &gt;
</pre></font>
<p>Find all <code>location</code>s with whose <code>x</code> coordinates are between 0 and 40
(inclusive) and whose <code>y</code> coordinates are between 60 and 100 (inclusive):
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(find-instances 'location '(known-world)
      '(within (x y) ((0 40) (60 100))))</font>
  (#&lt;location 1 (40 60)&gt;)
  &gt;
</pre></font>
<p>Find all <code>location</code>s with whose coordinates are not within the above
region:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(find-instances 'location '(known-world)
      '(not (within (x y) ((0 40) (60 100)))))</font>
  (#&lt;location 5 (20 30)&gt; #&lt;location 4 (25 25)&gt; #&lt;location 3 (20 20)&gt;
   #&lt;location 2 (70 30)&gt;)
  &gt;
</pre></font>
<h2><a name="id24">Step 13: Change a dimensional value</a></h2><p>
Recall that we assigned <code>location</code> <code>1</code> to the global variable
<code>ui</code>:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">ui</font>
  #&lt;location 1 (40 60)&gt;
  &gt;
</pre></font>
<p><a name="id25">and</a> we can retrieve it by its <code>x</code> and <code>y</code> coordinates:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(find-instances 'location '(known-world)
      '(= (x y) (40 60)))</font>
  (#&lt;location 1 (40 60)&gt;)
  &gt;
</pre></font>
<p><a name="id26">Let's</a> change its <code>x</code> position to <code>80</code> and try retrieving it again:
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(setf (x-of ui) 80)</font>
  80
  &gt; <font color="#000000">(find-instances 'location '(known-world)
      '(= (x y) (40 60)))</font>
  nil
  &gt;
</pre></font>
<p><a name="id27">It</a> has moved on the <code>known-world</code>.  As expected, the <code>location</code>
<code>1</code> unit instance is now at (80, 60):
</p>
<pre><font color="#8c8c8c">  &gt; <font color="#000000">(find-instances 'location '(known-world)
      '(= (x y) (80 60)))</font>
  (#&lt;location 1 (80 60)&gt;)
  &gt;
</pre></font>
<p>Also note that the textual representation of <code>location</code> <code>1</code>
also shows the new <code>x</code> slot value.
</p>
<hr /><address><a target="_top" class="address"
    href="http://GBBopen.org/"><p>The GBBopen Project</a></address><br />
<table width="100%" cellpadding="0" cellspacing="2"><tr>
<td bgcolor="#99ccff"><a href="tutorial-working-within-a-file.html"><img border="0" alt="Working Within a File" src="previous.png"/></a></td><td bgcolor="#99ccff"><a href="tutorial_0.html"><img border="0" alt="Top" src="up.png"/></a></td><td bgcolor="#99ccff"><a href="tutorial-control-shell.html"><img border="0" alt="Using a Control Shell" src="next.png"/></a></td><td align="center" bgcolor="#99ccff" width="100%"><b>Adding Dimensions</b></td><td bgcolor="#99ccff"><a target="_top" href="tutorial.html"><img border="0" alt="GoTo Top" src="top.png"/></a></td></tr></table></body></html>
